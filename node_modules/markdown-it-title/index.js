"use strict";

module.exports = function (md) {
  var level = arguments[1] === undefined ? 1 : arguments[1];

  var originalHeadingOpen = md.renderer.rules.heading_open;

  md.renderer.rules.heading_open = function () {
    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var tokens = args[0];
    var idx = args[1];
    var env = args[3];
    var self = args[4];

    if (!env.title && (level < 1 || tokens[idx].tag === "h" + level)) {
      env.title = tokens[idx + 1].children.reduce(function (acc, t) {
        return acc + t.content;
      }, "");
    }

    // Execute original rule.
    if (originalHeadingOpen) {
      return originalHeadingOpen.apply(this, args);
    } else {
      return self.renderToken.apply(self, args);
    }
  };
};
